**ΕΡΓΑΣΤΗΡΙΟ 11:**

**Είσοδος/Έξοδος - Αρχεία**

Στο εργαστήριο αυτό θα μελετήσουμε τους μηχανισμούς εισόδου/εξόδου που
μας παρέχει η C. Θα αναφερθούμε στις μονάδες εισόδου/εξόδου, που είναι
τα ρεύματα, θα κάνουμε μία επισκόπηση στα προκαθορισμένα ρεύματα και θα
ορίσουμε δικά μας ρεύματα για την επεξεργασία αρχείων κειμένου και
δυαδικών αρχείων.

**Άσκηση 1:** Αρχεία κειμένου

Κατασκευάστε το πρόγραμμα display.c που δέχεται ως όρισμα γραμμής
εντολής το όνομα ενός αρχείου κειμένου και προβάλλει ανά 20 τις γραμμές
του αρχείου, προτρέποντας τον χρήστη να συνεχίσει, αν επιθυμεί, έως ότου
συναντήσει το τέλος του αρχείου.

+-----------------------------------+-----------------------------------+
| FILE \*fopen(const char           | int fclose(FILE \*fp)             |
| \*filename,                       |                                   |
|                                   | Κλείνει το ρεύμα fp. Επιστρέφει 0 |
| const char \*mode)                | σε περίπτωση επιτυχίας.           |
|                                   |                                   |
| Ανοίγει το αρχείο με όνομα        |                                   |
| filename με τρόπο προσπέλασης που |                                   |
| καθορίζεται από το mode:          |                                   |
|                                   |                                   |
| -   "r": Διάβασμα από υπάρχον     |                                   |
|     αρχείο.                       |                                   |
|                                   |                                   |
| -   "w": Γράψιμο σε αρχείο. Αν το |                                   |
|     αρχείο δεν υπάρχει,           |                                   |
|     δημιουργείται. Αν υπάρχει,    |                                   |
|     διαγράφονται τα περιεχόμενά   |                                   |
|     του και το γράψιμο αρχίζει    |                                   |
|     από την αρχή.                 |                                   |
|                                   |                                   |
| -   "a": Προσάρτηση δεδομένων στο |                                   |
|     τέλος του αρχείου, χωρίς      |                                   |
|     διαγραφή των υπαρχόντων       |                                   |
|     περιεχομένων του.             |                                   |
|                                   |                                   |
| -   "r+": Διάβασμα και γράψιμο    |                                   |
|     οπουδήποτε στο αρχείο χωρίς   |                                   |
|     διαγραφή των υπαρχόντων       |                                   |
|     περιεχομένων του.             |                                   |
|                                   |                                   |
| -   "w+": Διάβασμα και γράψιμο    |                                   |
|     οπουδήποτε στο αρχείο με      |                                   |
|     διαγραφή των υπαρχόντων       |                                   |
|     περιεχομένων του.             |                                   |
|                                   |                                   |
| -   "a+": Διάβασμα οπουδήποτε     |                                   |
|     μέσα από το αρχείο και        |                                   |
|     γράψιμο μόνο στο τέλος του,   |                                   |
|     χωρίς διαγραφή των υπαρχόντων |                                   |
|     περιεχομένων του.             |                                   |
|                                   |                                   |
| -   Στις παραπάνω συμβολοσειρές   |                                   |
|     που δείχνουν τον τρόπο        |                                   |
|     προσπέλασης του αρχείου       |                                   |
|     προστίθεται και ο χαρακτήρας  |                                   |
|     b, αν πρόκειται για δυαδικό   |                                   |
|     αρχείο ("rb", "wb", "ab",     |                                   |
|     "rb+" ή "r+b", "wb+" ή "w+b", |                                   |
|     "ab+" ή "a+b").               |                                   |
|                                   |                                   |
| Επιστρέφει ένα ρεύμα μέσω του     |                                   |
| οποίου μπορούμε στη συνέχεια να   |                                   |
| αναφερόμαστε στο αρχείο, ή NULL,  |                                   |
| αν για κάποιο λόγο δεν ήταν       |                                   |
| δυνατόν να ανοίξει το αρχείο.     |                                   |
+-----------------------------------+-----------------------------------+
|                                   | int feof(FILE \*fp)               |
|                                   |                                   |
|                                   | Επιστρέφει τιμή διάφορη από το 0, |
|                                   | αν προηγούμενο διάβασμα απέτυχε   |
|                                   | λόγω του ότι τα δεδομένα στο      |
|                                   | αρχείο έχουν τελειώσει, αλλιώς    |
|                                   | επιστρέφει 0.                     |
+-----------------------------------+-----------------------------------+
|                                   | int fprintf(FILE \*fp, \...)      |
|                                   |                                   |
|                                   | int fscanf(FILE \*fp, \...)       |
|                                   |                                   |
|                                   | Ίδιες με τις printf και scanf,    |
|                                   | μόνο που γράφουν στο ρεύμα fp     |
|                                   | αντί του stdout ή διαβάζουν από   |
|                                   | το ρεύμα fp αντί του stdin,       |
|                                   | αντίστοιχα.                       |
+-----------------------------------+-----------------------------------+
|                                   | char \*fgets(char \*buf, int max, |
|                                   |                                   |
|                                   | FILE \*fp)                        |
|                                   |                                   |
|                                   | Διαβάζει το πολύ max-1 χαρακτήρες |
|                                   | από το ρεύμα fp μέχρι την αλλαγή  |
|                                   | γραμμής και τους φυλάσσει στο buf |
|                                   | (συμπεριλαμβανομένης και της      |
|                                   | αλλαγής γραμμής). Αν δεν υπάρχουν |
|                                   | δεδομένα για διάβασμα από το      |
|                                   | ρεύμα, επιστρέφει NULL.           |
+-----------------------------------+-----------------------------------+
|                                   | int getc(FILE \*fp)               |
|                                   |                                   |
|                                   | Επιστρέφει τον επόμενο χαρακτήρα  |
|                                   | από το ρεύμα fp, η EOF, αν έχουμε |
|                                   | φτάσει στο τέλος του αρχείου.     |
+-----------------------------------+-----------------------------------+

**Άσκηση 2:** Δυαδικά αρχεία

**2.1** Κατασκευάστε το πρόγραμμα grades.c, το οποίο να ανοίγει το
αρχείο grades.dat για γράψιμο σε δυαδική μορφή. Στη συνέχεια, να
διαβάζει ένα όνομα (συμβολοσειρά) από την πρότυπη είσοδο και έναν βαθμό
και να τα γράφει στο αρχείο. Το πρόγραμμα να τερματίζει όταν
επισημανθεί, με κάποιο τρόπο, το τέλος της εισόδου.

**2.2** Στη συνέχεια, επεκτείνετε το πρόγραμμά σας, ώστε να ανοίγει το
αρχείο grades.dat για διάβασμα, να διαβάζει τα δεδομένα που έχουν γραφεί
σ' αυτό και να τα προβάλλει στην οθόνη.

+-----------------------------------+-----------------------------------+
| size_t fread(void \*ptr, size_t   | size_t fwrite(const void \*ptr,   |
| size,                             |                                   |
|                                   | size_t size,                      |
| size_t count, FILE \*fp)          |                                   |
|                                   | size_t count,                     |
| Διαβάζει από το ρεύμα fp, το πολύ |                                   |
| count δεδομένα μεγέθους size το   | FILE \*fp)                        |
| καθένα και τα τοποθετεί από τη    |                                   |
| διεύθυνση ptr και μετά.           | Γράφει στο ρεύμα fp το πολύ count |
|                                   | δεδομένα μεγέθους size το καθένα, |
|                                   | παίρνοντάς τα από τη διεύθυνση    |
|                                   | ptr και μετά.                     |
+-----------------------------------+-----------------------------------+

Για να δείτε τα περιεχόμενα του αρχείου grades.dat, αν δουλεύετε σ' ένα
Unix σύστημα, χρησιμοποιήστε την εντολή "od -tu1c grades.dat".

**Άσκηση 3:** Δημιουργήστε το πρόγραμμα compare.c, το οποίο να δέχεται
στη γραμμή εντολής τα ονόματα δύο αρχείων και να ελέγχει αν τα αρχεία
αυτά είναι ίδια byte προς byte.

**Άσκηση 4:** Στην άσκηση αυτή θα υλοποιήσουμε ένα υποσύνολο της εντολής
wc του Unix. Συγκεκριμένα, θα κατασκευάσουμε πρόγραμμα που θα μετράει το
πλήθος των χαρακτήρων και το πλήθος των γραμμών ενός αρχείου κειμένου.

**4.1** Κατασκευάστε το πρόγραμμα count.c που να δέχεται ως όρισμα
γραμμής εντολής το όνομα ενός αρχείου κειμένου, να το ανοίγει για
διάβασμα, να μετράει το πλήθος των χαρακτήρων του αρχείου και να
προβάλλει το αποτέλεσμα στην οθόνη.

**4.2** Τροποποιήστε το πρόγραμμά σας, ώστε να μετράει και το πλήθος των
γραμμών του αρχείου.
